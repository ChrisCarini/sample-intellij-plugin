buildscript {
    ext {
        javaVersion = '1.8'

        // see https://www.jetbrains.com/intellij-repository/releases/
        // and https://www.jetbrains.com/intellij-repository/snapshots/
        // To use/download EAP add '-EAP-SNAPSHOT' to the version, i.e. 'IU-191.6014.8-EAP-SNAPSHOT'
        intellijVersion = '2019.3'
//    intellijVersion = '201.6668.13-EAP-SNAPSHOT'
    }
}

plugins {
    id 'java'
    id 'org.jetbrains.intellij' version '0.4.16'
}

group 'com.chriscarini.jetbrains'
version '0.1.1'

sourceCompatibility = javaVersion

repositories {
    mavenCentral()
}

test {
    useTestNG()
    useJUnit()
}

dependencies {
    testCompile 'org.testng:testng:6.1.1'
    testCompile "org.mockito:mockito-core:2.18.0"
}

intellij {
    version intellijVersion
    plugins[]
    pluginName 'sample-intellij-plugin'
}

//runIde {
//  jbrVersion 'jbrex8u202b1483.21'
//}

patchPluginXml {
    changeNotes """
        <h4>[0.1.1] - 2020-03-29</h4>
        <h5>Upgrade</h5>
        <ol>
        <li>Upgrading to 2019.3</li>
        <li>Upgrading IntelliJ Gradle plugin to 0.4.16</li>
        <li>Upgrading Gradle to 6.2</li>
        </ol>
        <h5>Added</h5>
        <ol>
        <li>N/A</li>
        </ol>
        <h5>Fixed</h5>
        <ol>
        <li>N/A</li>
        </ol>
      """
}

// Set the respective compiler arguments to fail the build if there are warnings.
tasks.withType(JavaCompile) {
    options.compilerArgs.addAll(['-Xlint:all',
                                 '-Xlint:-options',
                                 '-Xlint:-rawtypes',
                                 '-Xlint:-processing',
                                 '-Xlint:-path', // Ignore JBR SDK manifest element warnings
                                 '-proc:none',
                                 '-Werror',
                                 '-Xlint:-classfile']) //ignore warnings from dependencies
}